name: Astronomer CI - Deploy code

on:
  workflow_dispatch:
    inputs:
      deploymentId:
        description: "Deployment ID"
        required: true
        type: string
      apiToken:
        description: "Astro API Token"
        required: true
        type: string
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      ASTRO_API_TOKEN: ${{ secrets.ASTRO_API_TOKEN }}
      DEPLOYMENT_ID: ${{ vars.DEPLOYMENT_ID }}
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Install Astro CLI
        run: curl -sSL https://install.astronomer.io | sudo bash -s

      - name: Deploy to Astro
        uses: astronomer/deploy-action@v0.4
        with:
          deployment-id: "cmcllp7w10c2l01ky42d8ghda"
          api-token: "eyJhbGciOiJSUzI1NiIsImtpZCI6ImNsb2Q0aGtqejAya3AwMWozdWNqbzJwOHIiLCJ0eXAiOiJKV1QifQ.eyJhcGlUb2tlbklkIjoiY21jbG02b3R5MGM1aDAxbGllcG1vMWVmYyIsImF1ZCI6ImFzdHJvbm9tZXItZWUiLCJpYXQiOjE3NTE0NDAwNTEsImlzQXN0cm9ub21lckdlbmVyYXRlZCI6dHJ1ZSwiaXNJbnRlcm5hbCI6ZmFsc2UsImlzcyI6Imh0dHBzOi8vYXBpLmFzdHJvbm9tZXIuaW8iLCJraWQiOiJjbG9kNGhranowMmtwMDFqM3Vjam8ycDhyIiwicGVybWlzc2lvbnMiOlsiYXBpVG9rZW5JZDpjbWNsbTZvdHkwYzVoMDFsaWVwbW8xZWZjIiwid29ya3NwYWNlSWQ6Y21jbGxwMGZpMGMyZzAxa3liYThhMm5wYyIsIm9yZ2FuaXphdGlvbklkOmNtY2xsb3V2ZjBjMjcwMWt5YzM0c2J0aTMiLCJvcmdTaG9ydE5hbWU6Y21jbGxvdXZmMGMyNzAxa3ljMzRzYnRpMyJdLCJzY29wZSI6ImFwaVRva2VuSWQ6Y21jbG02b3R5MGM1aDAxbGllcG1vMWVmYyB3b3Jrc3BhY2VJZDpjbWNsbHAwZmkwYzJnMDFreWJhOGEybnBjIG9yZ2FuaXphdGlvbklkOmNtY2xsb3V2ZjBjMjcwMWt5YzM0c2J0aTMgb3JnU2hvcnROYW1lOmNtY2xsb3V2ZjBjMjcwMWt5YzM0c2J0aTMiLCJzdWIiOiJjbWNsbG5tcG0wYzF5MDFreWFnb2wweGV2IiwidmVyc2lvbiI6ImNtY2xtNm90eTBjNWcwMWxpaWppaWdxOGEifQ.iwh3H-Th712hrZW5Jf0jQQA6hNGp2p-7maZMzoU9mZQvtGQIbIGvS2k8jY2XuceFx9gIB4sbbGv6ucB0g_JPWqlEsZZdHMoxwPe41RAOIWtzeeQEKInIlYSdONmLPHBrqnhde5hKxXIYMXJzYddxxnPMw1GXFy-iOh1WRCmQgaiPanLYWNH9d_BBrFOEZsqnQbwjOGkzjsHDJUKFFXYRp5K0MhdmgGDpT0ix8BuBOlCCXrywPGGC4C0jGNudapQDtdWBCjmh4UIVjP08OENSpNplplf48Vf6Zgu5qcdX2rmAKhJt2qVjX9IeWAEOUy3vm6z-moS105SNbdEpxujUiA"
